<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta property="article:modified_time" content="2021-12-09T18:35:16-06:00" /><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Low-Level Debugging" href="low-level-debugging.html" /><link rel="prev" title="Create Custom User App" href="create-user-app.html" />

    <link rel="shortcut icon" href="../../_static/favicon.png"/><meta name="generator" content="sphinx-4.3.1, furo 2021.11.23"/>
        <title>Dual Core - AMDC Platform</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=7f0192ddeb2adecfbaa87ffbcf67d16358b30bc1" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">AMDC Platform</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">AMDC Platform</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GitHub Repositories</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Hardware">AMDC-Hardware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Firmware">AMDC-Firmware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/onboarding.html">Onboarding</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started/tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/tutorials/meet-amdc/index.html">Meet the AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/tutorials/blink/index.html">Blink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/tutorials/hw-commands/index.html">Hardware Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/tutorials/vsi/index.html">Voltage Source Inverter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/tutorials/profiling-tasks/index.html">Profiling Tasks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started/user-guide/index.html">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started/user-guide/host-interface/index.html">Host Interface</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/user-guide/host-interface/python-wrapper.html">Python Wrapper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started/user-guide/logging/index.html">Signal Logging</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/user-guide/logging/buffered.html">Buffered</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/user-guide/logging/streaming.html">Streaming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/user-guide/injection/index.html">Signal Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/user-guide/code-profiling.html">Code Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/user-guide/amds-interface.html">AMDS Interface</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/obtaining-hardware.html">Obtaining Hardware</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hardware/subsystems/index.html">Subsystems</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/picozed.html">PicoZed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/analog.html">Analog Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/encoder.html">Encoder Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/power-distribution.html">Power Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/power-stack.html">Power Stack Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/expansion-port.html">Expansion Port</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hardware/revisions/index.html">PCB Revisions</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/revisions/firmware-upgrades-per-hardware-target.html">Firmware Upgrades Per Hardware Target</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hardware/revisions/rev-d/index.html">REV D Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-bring-up.html">REV D Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-errata.html">REV D Errata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-pin-mapping.html">REV D Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hardware/revisions/rev-e/index.html">REV E Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-e/rev-e-bring-up.html">REV E Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-e/rev-e-pin-mapping.html">REV E Pin Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firmware</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Firmware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../arch/index.html">Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../arch/drivers.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/system.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/user-apps.html">User Apps</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Xilinx Tools</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing-xilinx-tools.html">Installing Xilinx Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="building-and-running-firmware.html">Building and Running Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="flashing.html">Flashing AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-private-repo.html">Create Private Repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-user-app.html">Create Custom User App</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Dual Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="low-level-debugging.html">Low-Level Debugging</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Accessories</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/amds/index.html">AMDS</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/amds-in-action/index.html">AMDS in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/firmware/index.html">Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/mainboard/index.html">Mainboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../accessories/amds/sensor-cards/index.html">Sensor Cards</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/high-voltage/index.html">High Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/low-voltage/index.html">Low Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/current/index.html">Current</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/uinverter/index.html">uInverter</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/hardware-design.html">Hardware Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/connections.html">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/rl-est/index.html">RL Estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/dac/index.html">DAC</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/dac/pcb-electrical-tests.html">PCB Electrical Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../accessories/test-board/index.html">TestBoard</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="dual-core">
<h1>Dual Core<a class="headerlink" href="#dual-core" title="Permalink to this headline">¶</a></h1>
<p>This document provides a background on dual-core programs running on the Xilinx Zynq-7000 SoC.
This does not have to be read or understood by users of the AMDC; the dual-core apps in the common AMDC code already work in dual-core mode.
However, if a user wants to build a new dual-core system from scratch, this document explains how.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>There are surprisingly few resources online about dual-core operation of the Xilinx Zynq-7000 SoC.
Below is a brief summary list:</p>
<ul class="simple">
<li><p>The main reference for this doc is the Xilinx application note <a class="reference external" href="https://www.xilinx.com/support/documentation/application_notes/xapp1079-amp-bare-metal-cortex-a9.pdf">XAPP1079</a> from 2014 written by John McDougall. This <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842504/XAPP1079+Latest+Information">Xilinx wiki page</a> gives updates to XAPP1079 as the dev software evolves.</p></li>
<li><p>The <a class="reference external" href="https://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf">Xilinx Zynq-7000 SoC Technical Reference Manual (TRM)</a> discusses dual-core operation extensively, but does not provide many actionable ideas. In fact, the TRM is written almost exclusively from the prospective of dual-core operation! But, it is &gt;1800 pages long; good luck reading it.</p></li>
<li><p>For information about running Linux on dual-core, check out <a class="reference external" href="https://www.xilinx.com/support/documentation/application_notes/xapp1078-amp-linux-bare-metal.pdf">XAPP1078</a></p></li>
</ul>
</section>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<p><strong>Symmetric Multi-Processing (SMP):</strong>
SMP refers to multi-core operation where the same exact executable is running on many cores at the same time.
This is used by all modern OS’s (e.g. Windows, Linux) which allows the scheduler to abstract the multi-core system.</p>
<p><strong>Asymmetric Multi-Processing (AMP):</strong>
AMP refers to multi-core operation where independent executables run on each core.
Each executable can operate completely independently, however, they must be aware that shared resources exist between the cores.
The programmer must be careful to ensure the cores cooperate in terms of the shared resources (e.g. peripherals, memory, etc).</p>
<p><strong>CPU0 vs. CPU1:</strong>
In all Xilinx documentation and on the AMDC platform, the two cores of the Zynq-7000 SoC are named <code class="docutils literal notranslate"><span class="pre">CPU0</span></code> and <code class="docutils literal notranslate"><span class="pre">CPU1</span></code>.
CPU0 is the main core and boots first, thus it is responsible for configuring shared resources.
CPU1 acts as the secondary core.</p>
<p><strong>On-Chip Memory (OCM):</strong>
The Xilinx Zynq-7000 SoC uses off-chip DRAM memory modules to form the bulk RAM which is used by the applications (i.e. 1 GB of RAM).
The SoC also has tightly coupled memory called on-chip memory (OCM) which is integrated into the SoC package (i.e. on die).
This memory is 256 KB and is accessible with low latency from both cores.</p>
<p><em>SMP is not used in the core AMDC firmware; only AMP is used.</em></p>
</section>
<section id="dual-core-programs">
<h2>Dual-Core Programs<a class="headerlink" href="#dual-core-programs" title="Permalink to this headline">¶</a></h2>
<p>Dual-core operation (AMP) requires two seperate executables being built from Xilinx SDK, meaning two seperate SDK application projects.
Each application project requires its own BSP project, since each BSP must specify on which core it will run.
Both BSPs use the same hardware wrapper project. In total, <strong>five</strong> distinct SDK projects are required for dual-core operation.</p>
<section id="create-the-bsps">
<h3>Create the BSPs<a class="headerlink" href="#create-the-bsps" title="Permalink to this headline">¶</a></h3>
<p>Ensure the AMDC hardware wrapper project exists as exported from Vivado.
Then, create two BSP projects as usual, but append <code class="docutils literal notranslate"><span class="pre">_cpuX</span></code> to each:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">amdc_bsp_cpu0</span></code> should target CPU0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amdc_bsp_cpu1</span></code> should target CPU1</p></li>
</ul>
<p>Update <code class="docutils literal notranslate"><span class="pre">amdc_bsp_cpu1</span></code> to build with extra compiler flags: <code class="docutils literal notranslate"><span class="pre">-DUSE_AMP=1</span></code>.
Using the “Board Support Package” window, append this flag to the “extra_compiler_flags” via the “drivers &gt; ps7_cortexa9_1” tab.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Forgetting to set the extra compiler flag will result in a dual-core program that does not work!</p>
</div>
</section>
<section id="create-the-applications">
<h3>Create the Applications<a class="headerlink" href="#create-the-applications" title="Permalink to this headline">¶</a></h3>
<p>Create two application projects, each one targetting one of the BSPs.
Name the applications: <code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code> and <code class="docutils literal notranslate"><span class="pre">app_cpu1</span></code>; CPU0 runs <code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code> and couples with <code class="docutils literal notranslate"><span class="pre">amdc_bsp_cpu0</span></code>, similiar for CPU1.
If this is your first time trying dual-core, start with simple “Hello World” programs.</p>
<section id="configure-dram-memory-regions">
<h4>Configure DRAM Memory Regions<a class="headerlink" href="#configure-dram-memory-regions" title="Permalink to this headline">¶</a></h4>
<p>By default, the linker script for both <code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code> and <code class="docutils literal notranslate"><span class="pre">app_cpu1</span></code> will allocate the full RAM region to both apps.
This is not valid and would result in the applications stepping on each other.
To avoid this, manually update the linker script <code class="docutils literal notranslate"><span class="pre">lscript.ld</span></code> for each application to seperate out the RAM regions.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code>: update <code class="docutils literal notranslate"><span class="pre">ps7_ddr_0</span></code> memory region: base address: <code class="docutils literal notranslate"><span class="pre">0x00100000</span></code>, size: <code class="docutils literal notranslate"><span class="pre">0x1FF80000</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">app_cpu1</span></code>: update <code class="docutils literal notranslate"><span class="pre">ps7_ddr_0</span></code> memory region: base address: <code class="docutils literal notranslate"><span class="pre">0x20080000</span></code>, size: <code class="docutils literal notranslate"><span class="pre">0x1FF80000</span></code></p></li>
</ul>
<p>The size is computed as half the default size of the RAM.</p>
<p>For advanced users, feel free to split the address space as two non-equal parts if one core has higher memory requirements (e.g. for buffered logging of an insane amount of data).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Forgetting to split the memory address space will cause undefined behavior.</p>
<p>The programs will run on the processor, but the memory will become corrupt!</p>
</div>
</section>
<section id="disable-ocm-caching">
<h4>Disable OCM Caching<a class="headerlink" href="#disable-ocm-caching" title="Permalink to this headline">¶</a></h4>
<p>CPU0 and CPU1 will most likely communicate with each other via OCM.
With this expectation, we will default to turning off caching to OCM for both cores so that no coherency issues arise.
The latency to OCM is small enough that the determinism advantage is worth the performance degradation.</p>
<p>On the Zynq-7000, the OCM is 256 KB is size, however, we will only use a 64 KB chunk.
Therefore, we will turn off caching to this 64 KB chunk.</p>
<p>On both cores (i.e. <code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code> and <code class="docutils literal notranslate"><span class="pre">app_cpu1</span></code>) in the first part of the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function, call the following Xilinx driver code:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"xil_mmu.h"</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Disable cache on OCM</span>
<span class="w">    </span><span class="c1">// S=b1 TEX=b100 AP=b11, Domain=b1111, C=b0, B=b0</span>
<span class="w">    </span><span class="n">Xil_SetTlbAttributes</span><span class="p">(</span><span class="mh">0xFFFF0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14de2</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="enable-bootloader-support">
<h3>Enable Bootloader Support<a class="headerlink" href="#enable-bootloader-support" title="Permalink to this headline">¶</a></h3>
<p>Dual-core operation is easily started via the debugging environment with JTAG, but this is not available when booting from flash.
When booting from flash, CPU0 starts automatically from the bootloader.
However, CPU0 must manually start CPU1.
For more information on the start-up process, consult the references linked above.</p>
<p>To start CPU1 from CPU0, add the following to <code class="docutils literal notranslate"><span class="pre">app_cpu0</span></code>’s <code class="docutils literal notranslate"><span class="pre">main()</span></code> function:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"xil_cache.h"</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"xil_io.h"</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"xil_mmu.h"</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="cp">#if 1</span>
<span class="w">        </span><span class="c1">// This code is required to start CPU1 from CPU0 during boot.</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// This only applies when booting from flash via the FSBL.</span>
<span class="w">        </span><span class="c1">// During development with JTAG loading, these low-level</span>
<span class="w">        </span><span class="c1">// calls in this #if block are not needed! However, we'll</span>
<span class="w">        </span><span class="c1">// keep them here since it doesn't affect performance...</span>

<span class="w">        </span><span class="c1">// Write starting base address for CPU1 PC.</span>
<span class="w">        </span><span class="c1">// It will look for this address upon waking up</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uintptr_t</span><span class="w"> </span><span class="n">CPU1_START_ADDR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFFFFF0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">CPU1_BASE_ADDR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x20080000</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">Xil_Out32</span><span class="p">(</span><span class="n">CPU1_START_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">CPU1_BASE_ADDR</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Waits until write has finished</span>
<span class="w">        </span><span class="c1">// DMB = Data Memory Barrier</span>
<span class="w">        </span><span class="n">dmb</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Wake up CPU1 by sending the SEV command</span>
<span class="w">        </span><span class="c1">// SEV = Set Event, which causes CPU1 to wake up and jump to CPU1_BASE_ADDR</span>
<span class="w">        </span><span class="n">__asm__</span><span class="p">(</span><span class="s">"sev"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="cp">#endif</span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        

        <div class="related-pages">
          <a class="next-page" href="low-level-debugging.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Low-Level Debugging</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="create-user-app.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Create Custom User App</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Severson Research Group |
            Last updated on Dec 09, 2021. |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../../_sources/firmware/xilinx-tools/dual-core.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74WCSDC0D0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-74WCSDC0D0');
</script>

<div class="google-analytics-tracking-info">
This page uses <a href="https://analytics.google.com/">Google Analytics</a> to collect statistics. Disable by blocking JavaScript from www.google-analytics.com.
</div>


      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Dual Core</a><ul>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#dual-core-programs">Dual-Core Programs</a><ul>
<li><a class="reference internal" href="#create-the-bsps">Create the BSPs</a></li>
<li><a class="reference internal" href="#create-the-applications">Create the Applications</a><ul>
<li><a class="reference internal" href="#configure-dram-memory-regions">Configure DRAM Memory Regions</a></li>
<li><a class="reference internal" href="#disable-ocm-caching">Disable OCM Caching</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enable-bootloader-support">Enable Bootloader Support</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    </body>
</html>