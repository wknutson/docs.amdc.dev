<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta property="article:modified_time" content="2022-07-31T13:31:51-05:00" /><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Hardware Overview" href="../../hardware/index.html" /><link rel="prev" title="Code Profiling" href="code-profiling.html" />

    <link rel="shortcut icon" href="../../_static/favicon.png"/><meta name="generator" content="sphinx-4.3.1, furo 2021.11.23"/>
        <title>AMDS Interface - AMDC Platform</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=7f0192ddeb2adecfbaa87ffbcf67d16358b30bc1" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">AMDC Platform</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">AMDC Platform</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GitHub Repositories</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Hardware">AMDC-Hardware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Firmware">AMDC-Firmware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../onboarding.html">Onboarding</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/meet-amdc/index.html">Meet the AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/blink/index.html">Blink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/hw-commands/index.html">Hardware Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/vsi/index.html">Voltage Source Inverter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/profiling-tasks/index.html">Profiling Tasks</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="host-interface/index.html">Host Interface</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="host-interface/python-wrapper.html">Python Wrapper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="logging/index.html">Signal Logging</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="logging/buffered.html">Buffered</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging/streaming.html">Streaming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="injection/index.html">Signal Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-profiling.html">Code Profiling</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">AMDS Interface</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/obtaining-hardware.html">Obtaining Hardware</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hardware/subsystems/index.html">Subsystems</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/picozed.html">PicoZed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/analog.html">Analog Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/encoder.html">Encoder Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/power-distribution.html">Power Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/power-stack.html">Power Stack Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/subsystems/expansion-port.html">Expansion Port</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hardware/revisions/index.html">PCB Revisions</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hardware/revisions/firmware-upgrades-per-hardware-target.html">Firmware Upgrades Per Hardware Target</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hardware/revisions/rev-d/index.html">REV D Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-bring-up.html">REV D Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-errata.html">REV D Errata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-d/rev-d-pin-mapping.html">REV D Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hardware/revisions/rev-e/index.html">REV E Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-e/rev-e-bring-up.html">REV E Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hardware/revisions/rev-e/rev-e-pin-mapping.html">REV E Pin Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firmware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware/index.html">Firmware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../firmware/development/index.html">Development</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../firmware/arch/index.html">Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/arch/drivers.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/arch/system.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/arch/user-apps.html">User Apps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../firmware/xilinx-tools/index.html">Xilinx Tools</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/installing-xilinx-tools.html">Installing Xilinx Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/building-and-running-firmware.html">Building and Running Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/flashing.html">Flashing AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/create-private-repo.html">Create Private Repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/create-user-app.html">Create Custom User App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/dual-core.html">Dual Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/xilinx-tools/low-level-debugging.html">Low-Level Debugging</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Accessories</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/amds/index.html">AMDS</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/amds-in-action/index.html">AMDS in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/firmware/index.html">Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/amds/mainboard/index.html">Mainboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../accessories/amds/sensor-cards/index.html">Sensor Cards</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/high-voltage/index.html">High Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/low-voltage/index.html">Low Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../accessories/amds/sensor-cards/current/index.html">Current</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/uinverter/index.html">uInverter</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/hardware-design.html">Hardware Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/connections.html">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/uinverter/rl-est/index.html">RL Estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../accessories/dac/index.html">DAC</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../accessories/dac/pcb-electrical-tests.html">PCB Electrical Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../accessories/test-board/index.html">TestBoard</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="amds-interface">
<h1>AMDS Interface<a class="headerlink" href="#amds-interface" title="Permalink to this headline">¶</a></h1>
<p>This document describes the built-in AMDC drivers which can be used to interface with the AMDS.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Before attempting to use these drivers, make sure to read about the AMDS in <a class="reference internal" href="../../accessories/amds/index.html"><span class="doc std std-doc">its documentation</span></a>.</p>
</div>
<section id="configure-amds-hardware">
<h2>Configure AMDS Hardware<a class="headerlink" href="#configure-amds-hardware" title="Permalink to this headline">¶</a></h2>
<p>First, the AMDS hardware needs to be configured:</p>
<ol class="simple">
<li><p>Supply 24V power to the AMDS via the screw terminals (LEDs should illuminate)</p></li>
<li><p>Install the four jumpers which select “daisy-chain” operation of the sensor cards. The daisy-chain mode is marked as <code class="docutils literal notranslate"><span class="pre">D</span></code> on the silkscreen.</p></li>
<li><p>Install the sensor cards. Since each SPI input is configured as daisy-chain, you need to populate the lower-number sensor cards before the higher, i.e., install 1 before 5. If you do not install the lower-number sensor card, the second sensor card in the daisy chain will not work!</p></li>
</ol>
<p>Now that the hardware is configured, the AMDC firmware must be configured.</p>
</section>
<section id="enable-amds-support">
<h2>Enable AMDS Support<a class="headerlink" href="#enable-amds-support" title="Permalink to this headline">¶</a></h2>
<p>By default, the AMDS drivers are not compiled into the C-code.</p>
<p>To enable, update the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file and set the following define to <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_ENABLE_MOTHERBOARD_SUPPORT (1)</span>
</pre></div>
</div>
</section>
<section id="command-line-interface">
<h2>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>Once the above #define is declared, the hardware will enable an AMDS interface app, this will show up as a set of <code class="docutils literal notranslate"><span class="pre">mb</span></code> commands at bootup. To enable AMDS usage in this app, we need to first route the mux to the appropriate ports. This is done through the <code class="docutils literal notranslate"><span class="pre">hw</span> <span class="pre">mux</span> <span class="pre">gpio</span> <span class="pre">&lt;port&gt;</span> <span class="pre">&lt;device&gt;</span></code> command call.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>AMDC Rev-D HW and earlier</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">1-2</span></code></p>
<ul>
<li><p>For Rev-D hardware utilizing this command interface, the AMDS should be connected to the top #1 port!</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;device&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">2</span></code> for the AMDS connection</p></li>
</ul>
<p>Once the <code class="docutils literal notranslate"><span class="pre">gpio_mux</span></code> is routed we can now make inquiries to the AMDS for data. This is done through the <code class="docutils literal notranslate"><span class="pre">mb</span> <span class="pre">&lt;idx&gt;</span> <span class="pre">XXXX</span></code> command structure described in the <code class="docutils literal notranslate"><span class="pre">help</span></code> interface.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;idx&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>AMDC Rev-E HW and later</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">1-4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;device&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">1</span></code> for the AMDS connection</p></li>
</ul>
<p>Once the <code class="docutils literal notranslate"><span class="pre">gpio_mux</span></code> is routed we can now make inquiries to the AMDS for data. This is done through the <code class="docutils literal notranslate"><span class="pre">mb</span> <span class="pre">&lt;idx&gt;</span> <span class="pre">XXXX</span></code> command structure described in the <code class="docutils literal notranslate"><span class="pre">help</span></code> interface.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;idx&gt;</span></code> ranges from  <code class="docutils literal notranslate"><span class="pre">0-3</span></code> and should correspond to the port #-1</p></li>
</ul>
</div>
<p>Try <code class="docutils literal notranslate"><span class="pre">mb</span> <span class="pre">0</span> <span class="pre">adc</span> <span class="pre">on</span></code> followed by the <code class="docutils literal notranslate"><span class="pre">mb</span> <span class="pre">0</span> <span class="pre">samples</span></code> command for the latest ADC poll.
The <code class="docutils literal notranslate"><span class="pre">counters</span></code> command is helpful for debugging connection issues, the <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> should be non-zero if the connection is active!</p>
</section>
<section id="configure-gpio-gp3io-mux-in-code">
<h2>Configure GPIO/GP3IO Mux in Code<a class="headerlink" href="#configure-gpio-gp3io-mux-in-code" title="Permalink to this headline">¶</a></h2>
<p>Since the AMDS can be plugged into any of the GPIO ports, the AMDC needs to be configured for the appropriate GPIO port.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>AMDC Rev-D and earlier utilizing gpio_mux</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">gpio_mux</span></code> FPGA IP block to configure the routing path.</p>
<p>Place the header file in the custom user app .c file</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"drv/gpio_mux.h"</span><span class="cp"></span>
</pre></div>
</div>
</div>
<p>Place the code below into your custom user app init function. Modify the the first variable in the function call to match the physical port connection joining the AMDC with the AMDS.  Note this is zero index and the GPIO port per the silk screen is 1’s indexed!</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Configure GPIO mux</span>
<span class="w">    </span><span class="c1">// 0: top port on AMDC</span>
<span class="w">    </span><span class="c1">// 1: bot port on AMDC, ect</span>
<span class="w">    </span><span class="c1">// GPIO_MUX_DEVICE1: Eddy current I/O IP block in the FPGA</span>
<span class="w">    </span><span class="c1">// GPIO_MUX_DEVICE2: AMDS interface I/O IP block in the FPGA</span>
<span class="w">       </span><span class="n">gpio_mux_set_device</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_MUX_DEVICE2</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>AMDC Rev-E and later utilizing gp3io_mux</p>
<p>Similar process as above, except the file and function call are now <code class="docutils literal notranslate"><span class="pre">gp3io</span></code>, and the <code class="docutils literal notranslate"><span class="pre">_DEVICE#</span></code> has swapped.</p>
<p>Include the header file in the custom user app .c file</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"drv/gp3io_mux.h"</span><span class="cp"></span>
</pre></div>
</div>
</div>
<p>Place the code below into your custom user app init function. Modify the <code class="docutils literal notranslate"><span class="pre">GP3IO_MUX_#_ADDR</span></code> define to match the physical port connection joining the AMDC with the AMDS.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Set up GPIO mux for the AMDS board</span>
<span class="w">    </span><span class="c1">// GP3IO_MUX_1_BASE_ADDR means top AMDC port</span>
<span class="w">    </span><span class="c1">// GP3IO_MUX_DEVICE1 is AMDS IP block</span>
<span class="w">    </span><span class="c1">// GP3IO_MUX_DEVICE2 is Eddy Current Sensor IP block</span>
<span class="w">       </span><span class="n">gp3io_mux_set_device</span><span class="p">(</span><span class="n">GP3IO_MUX_2_BASE_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">GP3IO_MUX_DEVICE1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="trigger-sampling">
<h2>Trigger Sampling<a class="headerlink" href="#trigger-sampling" title="Permalink to this headline">¶</a></h2>
<p>The AMDC firmware drivers trigger AMDS sensor sampling synchronous to both the peak and valley of the PWM carrier triangle wave.
When AMDS support is enabled, the sampling is automatically enabled.</p>
</section>
<section id="request-data">
<h2>Request Data<a class="headerlink" href="#request-data" title="Permalink to this headline">¶</a></h2>
<p>The sampled data on the AMDS must be transferred to the AMDC.
This operation can occur in the background by setting the following define to <code class="docutils literal notranslate"><span class="pre">1</span></code> in the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_ENABLE_MOTHERBOARD_AUTO_TX (1)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AUTO_TX</span></code> mode triggers the data to be sent to the AMDC <strong>after</strong> all tasks have executed in the time slice.
By definition, this causes a one sample delay in the sensed data used by the control algorithm.
However, it ensures that consistent new data is always available to the control task.
For most applications, this is acceptable.</p>
<p>If one sample delay is not acceptable for your application, keep the <code class="docutils literal notranslate"><span class="pre">AUTO_TX</span></code> mode disabled (i.e. set the define to <code class="docutils literal notranslate"><span class="pre">0</span></code>).
You must manually request data at the start of the control task, and then wait for the data to arrive before running the controller.
This reduces the time usable to compute the controller outputs since requesting and transmitting data from the AMDS is not instantaneous.</p>
<p>To request new data from the AMDS, call <code class="docutils literal notranslate"><span class="pre">motherboard_request_new_data()</span></code> from <code class="docutils literal notranslate"><span class="pre">drv/motherboard</span></code>.
The FPGA IP core currently does not expose a signal indicating when the data returns from the AMDS and is valid.
A skilled FPGA developer could alter the <code class="docutils literal notranslate"><span class="pre">amdc_motherboard</span></code> IP core to expose the signals <code class="docutils literal notranslate"><span class="pre">is_dout_valid0</span></code> and <code class="docutils literal notranslate"><span class="pre">is_dout_valid1</span></code> implemented in the <code class="docutils literal notranslate"><span class="pre">hdl/..._AXI.v</span></code> module.
For now, the <code class="docutils literal notranslate"><span class="pre">AUTO_TX</span></code> mode should be used.</p>
</section>
<section id="use-sampled-data">
<h2>Use Sampled Data<a class="headerlink" href="#use-sampled-data" title="Permalink to this headline">¶</a></h2>
<p>User code can read the raw 16-bit signed integer value as sampled on the AMDS sensor cards by using the following driver:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">motherboard_get_data</span><span class="p">(</span><span class="n">mb_channel_e</span><span class="w"> </span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">get_data()</span></code> is <strong>non-blocking</strong> – it will return the latest valid data that the AMDS sent, but will not trigger new data to be sent.
This matches how the integrated ADCs work on the AMDC.</p>
<p>For example, in a task callback:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">task_callback</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Read in integer value sampled on the AMDS from channel 1:</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">motherboard_get_data</span><span class="p">(</span><span class="n">MB_IN1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Now, "out" contains the sign-extended 16-bit sampled value</span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        

        <div class="related-pages">
          <a class="next-page" href="../../hardware/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Hardware Overview</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="code-profiling.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Code Profiling</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Severson Research Group |
            Last updated on Jul 31, 2022. |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../../_sources/getting-started/user-guide/amds-interface.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74WCSDC0D0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-74WCSDC0D0');
</script>

<div class="google-analytics-tracking-info">
This page uses <a href="https://analytics.google.com/">Google Analytics</a> to collect statistics. Disable by blocking JavaScript from www.google-analytics.com.
</div>


      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">AMDS Interface</a><ul>
<li><a class="reference internal" href="#configure-amds-hardware">Configure AMDS Hardware</a></li>
<li><a class="reference internal" href="#enable-amds-support">Enable AMDS Support</a></li>
<li><a class="reference internal" href="#command-line-interface">Command Line Interface</a></li>
<li><a class="reference internal" href="#configure-gpio-gp3io-mux-in-code">Configure GPIO/GP3IO Mux in Code</a></li>
<li><a class="reference internal" href="#trigger-sampling">Trigger Sampling</a></li>
<li><a class="reference internal" href="#request-data">Request Data</a></li>
<li><a class="reference internal" href="#use-sampled-data">Use Sampled Data</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    </body>
</html>